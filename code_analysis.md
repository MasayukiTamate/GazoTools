# GazoTools コード分析レポート

## 1. 全体構造
オブジェクト指向設計に基づき、UI（`GazoToolsApp.py`）、ロジック（`GazoToolsLogic.py`）、基本ライブラリ（`GazoToolsLib.py`）に分離。
`tkinterdnd2` を活用した高度なドラッグ＆ドロップ操作を実現。

## 2. 変数・関数の詳細（日本語コメント準拠）
各ファイル内に詳細な日本語コメントを付与し、処理の意図（なのじゃ語）を明確化。

## 3. 主要機能
- **画像表示**: `PIL` によるリサイズ表示。
- **画面保護**: 「スクリーンセーバー(自動再生)」モード。
- **クイック仕分け**: D&D による高速ファイル移動。最大12個のスロットをサポート。
- **自動巡回登録**: 登録エリアへのドロップでスロットを順次更新。

## 4. キーボードショートカット
| キー | 機能 | 対象 |
| :--- | :--- | :--- |
| **Space** | ランダムに画像を表示 | メイン |
| **Ctrl + E** | エクスプローラーで開く | メイン |
| **Ctrl + F** | メインウィンドウを最前面に | 全体 |
| **Ctrl + R** | 全ての画像を閉じる | 全体 |
| **Ctrl + T** | 全ての画像をタイル状に整列 | 全体 |
| **Escape** | スクリーンセーバー停止 | 全体 |

## 5. タイル表示・パズルレイアウトシステム
- **パズルタイル表示機能**: 全画像を画面全体に再帰的領域分割アルゴリズムを用いて隙間なく並べる。`ImageOps.fit` を使用してアスペクト比を維持しつつ、割り当てられた領域を完全に埋めるクロップ処理を行う。
- **動的ワークエリア取得**: Windows API (`ctypes`) を利用して、タスクバー等を除いた「有効なデスクトップ領域」を動的に取得。どのような環境でも画面端にぴったりと配置される。
- **没入モード**: 実行時に `overrideredirect(True)` を設定し、タイトルバー（枠）を非表示にすることで画像のみが並ぶ没入感の高い表示を実現。
- **枠なしドラッグ移動**: タイトルバーがないウィンドウでも、画像そのもの（Canvas）を左ドラッグすることで自由に移動・微調整が可能。絶対座標を用いたスムーズなドラッグ操作を実装。

## 6. D&D画像移動（仕分け）システム
- **メモリ管理の徹底**: `with` 構文による画像ファイルの確実なクローズと、`del` による一時オブジェクトの早期破棄を行い、メモリ蓄積（リーク）を防止。
- **超・多段構成**: スロット数（2〜12）に応じてUIを動的に再構築（グリッド配置）。
- **ワンアクション登録**: 右クリックメニューに各スロットの現在の内容（フォルダ名 or 未登録）を直接表示。選ぶだけで即座に上書き可能。
- **一括リセット**: メイン窓最下部のボタン、または設定メニューから全スロットを初期化可能。
- **登録を挿入**: メニュー先頭の「登録を挿入」で、現在の枠にセットして次へ進める。
- **エリア間余白**: 登録と移動の間に十分なマージン（pady=15）を確保し、誤操作を防止。
- **永続化**: `config.json` にて 12 個のスロットと設定数を完全に管理。

## 7. ウィンドウ管理
`open_windows` 辞書により、重複表示の防止と一括削除（Ctrl+R）を制御。
各ウィンドウのジオメトリも終了時に保存。
